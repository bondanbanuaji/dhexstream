import{r as m}from"./main-BicMX7AG.js";const p=new Map;let c=[],h=!1;const d=400,_=async()=>{if(!(h||c.length===0)){for(h=!0;c.length>0;){const{title:e,resolve:n,reject:a}=c.shift();try{const r=await I(e);n(r)}catch(r){a(r)}c.length>0&&await new Promise(r=>setTimeout(r,d))}h=!1}},I=async e=>{var a,r,i,t,s,o,l;if(p.has(e))return p.get(e);const n=e.replace(/\(TV\)/gi,"").replace(/S\d+/gi,"").replace(/Season\s*\d+/gi,"").replace(/sub\s*indo/gi,"").replace(/subtitle\s*indonesia/gi,"").replace(/[^\w\s-]/gi,"").trim();if(!n)return null;try{const u=await fetch(`https://api.jikan.moe/v4/anime?q=${encodeURIComponent(n)}&limit=1`,{method:"GET",headers:{Accept:"application/json"}});if(u.status===429)return null;if(!u.ok)throw new Error(`Jikan API error: ${u.status}`);const f=await u.json(),g=(a=f==null?void 0:f.data)==null?void 0:a[0];if(g){const w=((i=(r=g.trailer)==null?void 0:r.images)==null?void 0:i.maximum_image_url)||((s=(t=g.images)==null?void 0:t.jpg)==null?void 0:s.large_image_url)||((l=(o=g.images)==null?void 0:o.webp)==null?void 0:l.large_image_url)||null;return p.set(e,w),w}return null}catch{return null}},T=e=>{const[n,a]=m.useState(null),[r,i]=m.useState(!0),t=m.useRef(null);return m.useEffect(()=>{if(!e||e.length<3){i(!1);return}const s=new Promise((o,l)=>{c.push({title:e,resolve:o,reject:l}),_()});return t.current=s,s.then(o=>{t.current===s&&(a(o),i(!1))}).catch(()=>{t.current===s&&i(!1)}),()=>{t.current=null}},[e]),{image:n,loading:r}};export{T as u};
