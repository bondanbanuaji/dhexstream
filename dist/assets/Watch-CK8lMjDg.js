import{c as u,u as U,j as e,P as W,C as p,a as F,Z as R}from"./main-qQthZKlx.js";import{f as X,r as x,L as m}from"./vendor-YPvam5jz.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=u("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=u("LayoutList",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}],["path",{d:"M14 4h7",key:"3xa0d5"}],["path",{d:"M14 9h7",key:"1icrd9"}],["path",{d:"M14 15h7",key:"1mj8o2"}],["path",{d:"M14 20h7",key:"11slyb"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=u("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),K=()=>{var S,E,$,z,C,L,P,T;const{id:n,ep:d}=X(),[f,v]=x.useState(null),[h,b]=x.useState(""),[j,w]=x.useState(!1),{data:r,loading:M,error:A}=U("episode",{ep:d}),{data:t}=U("anime",{id:n});x.useEffect(()=>{r&&r.data&&b(r.data.defaultStreamingUrl)},[r]),x.useEffect(()=>{r!=null&&r.data&&(t!=null&&t.data)&&d&&(async()=>{try{console.log("ðŸ“ Logging watch history:",{animeId:t.data.animeId,title:r.data.title||t.data.title,episode:d});const s=await(await fetch("/dhexstream/api.php?endpoint=log_recent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({animeId:t.data.animeId,title:r.data.title||t.data.title,poster:t.data.poster,href:`${t.data.animeId}/${d}`,currentTime:0,duration:0})})).json();console.log("âœ… Watch history logged:",s)}catch(i){console.error("âŒ Failed to log history:",i)}})()},[r,t,d]);const B=async a=>{w(!0),v(a);try{const s=await(await fetch(`/dhexstream/api.php?endpoint=server&server_id=${a}`)).json();s&&s.data&&s.data.url&&b(s.data.url)}catch(i){console.error("Failed to load server",i)}finally{setTimeout(()=>w(!1),500)}};if(x.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"}),b(""),v(null)},[d]),M)return e.jsxs("div",{className:"min-h-screen pt-20 flex flex-col items-center justify-center bg-gradient-to-br from-dhex-bg via-dhex-bg-secondary to-dhex-bg",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 border-4 border-dhex-accent/20 rounded-full"}),e.jsx("div",{className:"w-20 h-20 border-4 border-dhex-accent border-t-transparent rounded-full animate-spin absolute top-0"}),e.jsx(W,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-dhex-accent animate-pulse",size:32,fill:"currentColor"})]}),e.jsx("p",{className:"text-dhex-accent mt-6 font-bold text-lg animate-pulse",children:"Loading Stream..."})]});if(A)return e.jsx("div",{className:"min-h-screen pt-20 flex flex-col items-center justify-center",children:e.jsxs("div",{className:"text-center bg-red-500/10 border-2 border-red-500/30 rounded-2xl p-10 max-w-md backdrop-blur-md",children:[e.jsx("div",{className:"w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-4xl",children:"âš ï¸"})}),e.jsx("p",{className:"text-red-500 text-2xl mb-2 font-bold",children:"Stream Error"}),e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Unable to load the episode stream"}),e.jsxs(m,{to:`/anime/${n}`,className:"inline-flex items-center gap-2 px-6 py-3 bg-dhex-accent hover:bg-dhex-accent-hover text-white rounded-lg font-semibold transition-all",children:[e.jsx(p,{size:18})," Back to Anime"]})]})});const N=((S=t==null?void 0:t.data)==null?void 0:S.episodeList)||[],Y=((E=r==null?void 0:r.data)==null?void 0:E.title)||`Episode ${d}`,y=((z=($=r==null?void 0:r.data)==null?void 0:$.server)==null?void 0:z.qualities)||[],k=((C=t==null?void 0:t.data)==null?void 0:C.title)||"Loading...",I=(L=t==null?void 0:t.data)==null?void 0:L.poster,c=[...N||[]].reverse(),o=c.findIndex(a=>a&&a.episodeId===d),g=o>=0?o+1:1,q=o>0,O=o<c.length-1;return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-dhex-bg via-dhex-bg-secondary to-dhex-bg pt-6 pb-20",children:[e.jsxs("div",{className:"container mx-auto px-4 md:px-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6 animate-fade-in-up",children:e.jsxs(m,{to:`/anime/${n}`,className:"group inline-flex items-center gap-2 px-4 py-2 bg-white/5 hover:bg-white/10 border border-white/10 hover:border-dhex-accent/50 rounded-xl transition-all backdrop-blur-sm",children:[e.jsx(p,{size:20,className:"group-hover:-translate-x-1 transition-transform"}),e.jsx("span",{className:"text-gray-400 group-hover:text-white transition-colors font-medium",children:"Back to Anime"})]})}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs("div",{className:"flex-grow lg:w-3/4 space-y-6 animate-fade-in-up",style:{animationDelay:"0.1s"},children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute -inset-1 bg-gradient-to-r from-dhex-accent via-purple-500 to-pink-500 rounded-2xl blur opacity-25 group-hover:opacity-40 transition duration-1000 group-hover:duration-200 animate-pulse"}),e.jsx("div",{className:"relative aspect-video bg-black rounded-xl overflow-hidden shadow-2xl border border-white/10",children:h?h.endsWith(".mp4")||h.endsWith(".mkv")?e.jsx("video",{src:h,className:"w-full h-full",controls:!0,autoPlay:!0,playsInline:!0,children:"Your browser does not support the video tag."}):e.jsx("iframe",{src:h,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0,title:"Episode Player"}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-gray-500 bg-gradient-to-br from-dhex-bg-secondary to-dhex-bg",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-dhex-accent/20 rounded-full"}),e.jsx("div",{className:"w-16 h-16 border-4 border-dhex-accent border-t-transparent rounded-full animate-spin absolute top-0"})]}),e.jsx("p",{className:"text-lg font-semibold animate-pulse",children:"Initializing Stream..."})]})})]}),e.jsx("div",{className:"bg-gradient-to-br from-dhex-bg-secondary to-dhex-bg rounded-xl p-6 border border-white/10 backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-start gap-4",children:[I&&e.jsx("div",{className:"hidden sm:block w-24 h-32 rounded-lg overflow-hidden flex-shrink-0 border-2 border-dhex-accent/30 shadow-lg shadow-dhex-accent/20",children:e.jsx("img",{src:I,alt:k,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"px-3 py-1 bg-dhex-accent/20 border border-dhex-accent/50 rounded-full text-dhex-accent text-xs font-bold uppercase",children:["Episode ",g]}),e.jsx("span",{className:"w-1 h-1 bg-gray-600 rounded-full"}),e.jsx("span",{className:"text-gray-500 text-xs",children:"Now Playing"})]}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-white mb-2 leading-tight",children:Y}),e.jsx("p",{className:"text-gray-400 text-sm flex items-center gap-2",children:e.jsx("span",{children:k})})]})]})}),c.length>0&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[q?e.jsx(m,{to:`/watch/${n}/${(P=c[o-1])==null?void 0:P.episodeId}`,className:"group bg-gradient-to-br from-white/5 to-white/10 hover:from-white/10 hover:to-white/15 border border-white/10 hover:border-dhex-accent/50 rounded-xl p-4 transition-all backdrop-blur-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full flex items-center justify-center group-hover:bg-dhex-accent/20 transition-colors",children:e.jsx(p,{size:20,className:"text-dhex-accent"})}),e.jsxs("div",{className:"flex-grow text-left",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase font-semibold mb-1",children:"Previous"}),e.jsxs("p",{className:"text-sm text-white font-medium truncate",children:["Episode ",g-1]})]})]})}):e.jsx("div",{className:"bg-white/5 border border-white/5 rounded-xl p-4 opacity-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full flex items-center justify-center",children:e.jsx(p,{size:20,className:"text-gray-600"})}),e.jsx("div",{className:"flex-grow text-left",children:e.jsx("p",{className:"text-xs text-gray-600 uppercase font-semibold",children:"No Previous"})})]})}),O?e.jsx(m,{to:`/watch/${n}/${(T=c[o+1])==null?void 0:T.episodeId}`,className:"group bg-gradient-to-br from-dhex-accent/20 to-dhex-accent/30 hover:from-dhex-accent hover:to-dhex-accent-hover border border-dhex-accent/50 hover:border-dhex-accent rounded-xl p-4 transition-all shadow-lg shadow-dhex-accent/20",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-grow text-right",children:[e.jsx("p",{className:"text-xs text-dhex-accent group-hover:text-white uppercase font-semibold mb-1",children:"Next"}),e.jsxs("p",{className:"text-sm text-white font-medium truncate",children:["Episode ",g+1]})]}),e.jsx("div",{className:"w-10 h-10 bg-white/20 group-hover:bg-white/30 rounded-full flex items-center justify-center transition-colors",children:e.jsx(F,{size:20,className:"text-white"})})]})}):e.jsx("div",{className:"bg-white/5 border border-white/5 rounded-xl p-4 opacity-50",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-grow text-right",children:e.jsx("p",{className:"text-xs text-gray-600 uppercase font-semibold",children:"No Next"})}),e.jsx("div",{className:"w-10 h-10 bg-white/10 rounded-full flex items-center justify-center",children:e.jsx(F,{size:20,className:"text-gray-600"})})]})})]}),y.length>0&&e.jsxs("div",{className:"bg-gradient-to-br from-dhex-bg-secondary to-dhex-bg rounded-xl p-6 border border-white/10 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(J,{size:20,className:"text-dhex-accent"}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Select Server"}),j&&e.jsxs("div",{className:"ml-auto flex items-center gap-2 text-dhex-accent text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-dhex-accent border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Switching..."})]})]}),e.jsx("div",{className:"space-y-4",children:y.map((a,i)=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{size:14,className:"text-dhex-accent"}),e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold tracking-wider",children:a.title})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.serverList.map((s,l)=>e.jsxs("button",{onClick:()=>B(s.serverId),disabled:j,className:`group relative px-4 py-2.5 rounded-lg text-sm font-semibold uppercase transition-all disabled:opacity-50 disabled:cursor-not-allowed ${f===s.serverId?"bg-gradient-to-r from-dhex-accent to-dhex-accent-hover text-white shadow-lg shadow-dhex-accent/50":"bg-white/10 hover:bg-white/20 text-gray-300 hover:text-white border border-white/10 hover:border-dhex-accent/50"}`,children:[f===s.serverId&&e.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-dhex-bg flex items-center justify-center",children:e.jsx(Z,{size:10,className:"text-white"})}),e.jsx("span",{className:"flex items-center gap-2",children:s.serverName||s.title||`Server ${l+1}`})]},s.serverId))})]},i))})]})]}),e.jsx("div",{className:"lg:w-1/4 flex-shrink-0 animate-fade-in-up",style:{animationDelay:"0.2s"},children:e.jsx("div",{className:"sticky top-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-dhex-bg-secondary to-dhex-bg rounded-xl overflow-hidden border border-white/10 shadow-2xl backdrop-blur-sm",children:[e.jsx("div",{className:"p-4 border-b border-white/10 bg-gradient-to-r from-dhex-accent/10 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"font-bold text-white flex items-center gap-2",children:[e.jsx(_,{size:18,className:"text-dhex-accent"}),"Episodes"]}),e.jsx("span",{className:"px-2 py-1 bg-dhex-accent/20 border border-dhex-accent/30 rounded-full text-dhex-accent text-xs font-bold",children:N.length})]})}),e.jsx("div",{className:"overflow-y-auto h-[calc(100vh-250px)] max-h-[600px] p-3 space-y-2 custom-scrollbar",children:c.map((a,i)=>{const s=i+1,l=a.episodeId===d;return e.jsxs(m,{to:`/watch/${n}/${a.episodeId}`,className:`group block p-3 rounded-lg transition-all relative overflow-hidden ${l?"bg-gradient-to-r from-dhex-accent to-dhex-accent-hover text-white shadow-lg shadow-dhex-accent/30":"bg-white/5 hover:bg-white/10 text-gray-400 hover:text-white border border-white/5 hover:border-dhex-accent/30"}`,children:[l&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent animate-shimmer"}),e.jsxs("div",{className:"relative flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center font-bold text-sm flex-shrink-0 ${l?"bg-white/20":"bg-white/10 group-hover:bg-dhex-accent/20"}`,children:l?e.jsx(W,{size:16,fill:"currentColor"}):s}),e.jsxs("div",{className:"flex-grow min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-semibold text-sm truncate",children:["Episode ",a.number||s]}),l&&e.jsx("span",{className:"flex-shrink-0 text-xs bg-white/20 px-2 py-0.5 rounded-full ml-2",children:"Now"})]}),e.jsx("div",{className:"text-xs opacity-70 truncate",children:a.title||`Episode ${s}`})]})]})]},a.episodeId)})})]})})})]})]}),e.jsx("style",{jsx:!0,children:`
                @keyframes shimmer {
                    0% { transform: translateX(-100%); }
                    100% { transform: translateX(100%); }
                }
                .animate-shimmer {
                    animation: shimmer 2s infinite;
                }
                .animate-fade-in-up {
                    animation: fadeInUp 0.6s ease-out forwards;
                    opacity: 0;
                }
                @keyframes fadeInUp {
                    from {
                        opacity: 0;
                        transform: translateY(20px);
                    }
                    to {
                        opacity: 1;
                        transform: translateY(0);
                    }
                }
                .custom-scrollbar::-webkit-scrollbar {
                    width: 6px;
                }
                .custom-scrollbar::-webkit-scrollbar-track {
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb {
                    background: linear-gradient(180deg, var(--dhex-accent), var(--dhex-accent-hover));
                    border-radius: 10px;
                }
                .custom-scrollbar::-webkit-scrollbar-thumb:hover {
                    background: var(--dhex-accent-hover);
                }
            `})]})};export{K as default};
